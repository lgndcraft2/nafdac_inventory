{% extends 'base.html' %}

{% block title %}Update Equipment{% endblock %}
{% block head %} <link rel="stylesheet" href="{{ url_for('static', filename='css/addEquipment.css') }}"> {% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h1 class="form-title">Update Equipment</h1>
        <p class="form-subtitle">Edit details for this equipment</p>
    </div>

    <form id="equipmentForm" data-id="{{ equipment.id }}">
        <div class="form-grid">
            <div class="form-group">
                <input type="text" name="name" placeholder="Equipment Name" value="{{equipment.name}}" required>
                <div class="error-message" id="name-error">Equipment name is required</div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <input type="text" name="manufacturer" placeholder="Manufacturer" value="{{equipment.manufacturer}}" required>
                    <div class="error-message" id="manufacturer-error">Please enter a valid manufacturer</div>
                </div>
                <div class="form-group">
                    <input type="text" name="model" placeholder="Model" required value="{{equipment.model}}">
                    <div class="error-message" id="model-error">Please enter a valid model</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <input type="text" name="serial_number" placeholder="Serial Number" required value="{{equipment.serial_number}}">
                    <div class="error-message" id="serial_number-error">Serial number should be alphanumeric</div>
                </div>
                <div class="form-group">
                    <input type="text" name="new_id_number" placeholder="New ID Number" required value="{{equipment.new_id_number}}">
                    <div class="error-message" id="new_id_number-error">ID number should be alphanumeric and unique</div>
                </div>
            </div>

            <div class="form-group">
                <input type="text" name="location" placeholder="Location" required value="{{equipment.location}}">
                <div class="error-message" id="location-error">Please enter a valid location</div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="calibration_date">Calibration Date:</label>
                    <input type="date" name="calibration_date" id="calibration_date" required value="{{equipment.calibration_date}}">
                    <div class="error-message" id="calibration_date-error">Invalid calibration date</div>
                </div>
                <div class="form-group">
                    <label for="maintenance_date">Maintenance Date:</label>
                    <input type="date" name="maintenance_date" id="maintenance_date" required value="{{equipment.maintenance_date}}">
                    <div class="error-message" id="maintenance_date-error">Invalid maintenance date</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="calibration_frequency">Calibration Frequency</label>
                    <select name="calibration_frequency" id="calibration_frequency" required value="{{equipment.calibration_frequency}}">
                        <option value="">Select Frequency</option>
                        <option value="Monthly" {% if equipment.calibration_frequency == 'Monthly' %}selected{% endif %}>Monthly</option>
                        <option value="Quarterly" {% if equipment.calibration_frequency == 'Quarterly' %}selected{% endif %}>Quarterly</option>
                        <option value="Semi-Annual" {% if equipment.calibration_frequency == 'Semi-Annual' %}selected{% endif %}>Bi-Annual</option>
                        <option value="Annual" {% if equipment.calibration_frequency == 'Annual' %}selected{% endif %}>Annual</option>
                    </select>
                    <div class="error-message" id="calibration_frequency-error">Please select calibration frequency</div>
                </div>
                <div class="form-group">
                    <label for="maintenance_frequency">Maintenance Frequency</label>
                    <select name="maintenance_frequency" id="maintenance_frequency" required value="{{equipment.maintenance_frequency}}">
                        <option value="">Select Frequency</option>
                        <option value="Monthly" {% if equipment.maintenance_frequency == 'Monthly' %}selected{% endif %}>Monthly</option>
                        <option value="Quarterly" {% if equipment.maintenance_frequency == 'Quarterly' %}selected{% endif %}>Quarterly</option>
                        <option value="Semi-Annual" {% if equipment.maintenance_frequency == 'Semi-Annual' %}selected{% endif %}>Bi-Annual</option>
                        <option value="Annual" {% if equipment.maintenance_frequency == 'Annual' %}selected{% endif %}>Annual</option>
                    </select>
                    <div class="error-message" id="maintenance_frequency-error">Please select maintenance frequency</div>
                </div>
            </div>

            <div class="form-group">
                <input type="number" name="quantity" placeholder="Quantity" min="1" value="{{equipment.quantity}}">
                <div class="error-message" id="quantity-error">Quantity must be at least 1</div>
            </div>

            <div class="form-group full-width">
                <textarea name="description" placeholder="Equipment Description (optional)">{{equipment.description}}</textarea>
                <div class="error-message" id="description-error">Description is too long</div>
            </div>

            <div class="form-group full-width">
                    <div class="parameters-section">
                        <div class="parameters-header">
                            <span class="parameters-title">Equipment Parameters</span>
                            <button type="button" class="add-parameter-btn" id="addParameterBtn">
                                <span>+</span> Add Parameter
                            </button>
                        </div>
                        <div id="parametersContainer">
                            {% if equipment.parameters %}
                                {% for p in equipment.parameters %}
                                <div class="parameter-item" data-parameter-id="{{loop.index}}">
                                    <input type="text" class="param-name" value="{{p.parameter_name}}">
                                    <input type="text" class="param-value" value="{{p.parameter_value}}">
                                    <button type="button" class="remove-parameter-btn" onclick="update_equipment_form_validator.removeParameter({{loop.index}})">×</button>
                                </div>
                                {% endfor %}
                            {%else%}
                                <div class="parameters-empty" id="parametersEmpty">
                                    No parameters added yet. Click "Add Parameter" to add equipment specifications.
                                </div>
                            {%endif%}
                        </div>
                    </div>
            </div>

            <button type="submit" class="submit-btn">Update Equipment</button>
        </div>
    </form>

    <div class="success-message" id="success-message">
        Equipment Updated successfully! ✓
    </div>
    <a href="/dashboard" class="arrow-link">Back to Dashboard</a>
</div>
<script src="{{ url_for('static', filename='js/updateEquipment.js') }}"></script>
{% endblock %}